<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Nexus Auto Pro 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="assets/logo-auto.png" />
  <link rel="stylesheet" href="styles.css?v=10" />

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

  <!-- ========== LOGIN (PIN + GOOGLE) ========== -->
  <div id="loginView" class="view visible">
    <div class="auth-shell">
      <div class="auth-brand">
        <img src="assets/logo-auto.png" alt="Nexus Auto Pro" class="auth-logo" />
        <h1>Nexus Auto Pro 2026</h1>
        <p>Suite corporativa para gestión de talleres automotrices en Puerto Rico</p>
      </div>

      <div class="auth-panels">
        <!-- Tarjeta PIN -->
        <div class="card auth-card primary-card">
          <div class="card-header">
            <h2>Acceso con PIN</h2>
            <p>Acceso rápido para el personal del taller.</p>
          </div>
          <div class="card-body">
            <form id="pinForm" class="pin-form">
              <label for="pinInput">PIN de acceso</label>
              <input id="pinInput" type="password" maxlength="6" autocomplete="off"
                     placeholder="••••" required />
              <button type="submit" class="btn primary full">Entrar</button>
              <p class="pin-hint">
                PIN inicial por defecto: <strong>0000</strong> (cámbialo en <u>Configuración</u>).
              </p>
            </form>
          </div>
        </div>

        <!-- Tarjeta Google Auth -->
        <div class="card auth-card">
          <div class="card-header">
            <h2>Acceso con Google</h2>
            <p>Multiusuario · Datos compartidos en la nube.</p>
          </div>
          <div class="card-body">
            <button id="googleSignInBtn" class="btn outline full">
              Entrar con Google (taller)
            </button>
            <ul class="auth-features">
              <li>Sincronizado en todos los dispositivos</li>
              <li>Historial de ingresos, cotizaciones y facturas</li>
              <li>Un solo panel para todo el taller</li>
            </ul>
          </div>
        </div>
      </div>

      <p class="login-footer">
        Nexus Auto Pro 2026 · Hecho para talleres que se toman en serio su operación.
      </p>
    </div>
  </div>

  <!-- ========== APP PRINCIPAL ========== -->
  <div id="appView" class="view">
    <!-- HEADER / MENÚ -->
    <header class="app-header">
      <div class="brand">
        <img src="assets/logo-auto.png" alt="Nexus Auto Pro" class="brand-logo" />
        <div class="brand-text">
          <h2>Nexus Auto Pro 2026</h2>
          <p>Taller automotriz · Puerto Rico</p>
        </div>
      </div>

      <nav class="main-menu">
        <button class="menu-btn active" data-view="ingresosView">Panel / Ingresos</button>
        <button class="menu-btn" data-view="entregasView">Entregas</button>
        <button class="menu-btn" data-view="historialView">Historial</button>
        <button class="menu-btn" data-view="cotizacionesView">Cotizaciones</button>
        <button class="menu-btn" data-view="facturasView">Facturas</button>
        <button class="menu-btn" data-view="clientesView">Clientes</button>
        <button class="menu-btn" data-view="suplidoresView">Suplidores</button>
        <button class="menu-btn" data-view="configView">Configuración</button>
        <button class="menu-btn danger" id="logoutBtn">Salir</button>
      </nav>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="app-main">

      <!-- ========== INGRESOS (Dashboard + tarjetas) ========== -->
      <section id="ingresosView" class="screen visible">
        <div class="screen-header">
          <div>
            <h1>Ingresos de vehículos</h1>
            <p class="section-subtitle">
              Registro central de entradas a mecánica, hojalatería, pintura y detailing.
            </p>
          </div>
        </div>

        <!-- KPIs (puedes llenarlos luego con datos reales) -->
        <div class="kpi-row">
          <div class="kpi-card" id="kpiIngresos">
            <span class="kpi-label">Ingresos abiertos</span>
            <span class="kpi-value">—</span>
            <span class="kpi-foot">Cantidad de vehículos en proceso</span>
          </div>
          <div class="kpi-card" id="kpiMecanica">
            <span class="kpi-label">Trabajos de mecánica</span>
            <span class="kpi-value">—</span>
            <span class="kpi-foot">Incluye diagnóstico y reparación</span>
          </div>
          <div class="kpi-card" id="kpiUltimoIngreso">
            <span class="kpi-label">Último ingreso</span>
            <span class="kpi-value">—</span>
            <span class="kpi-foot">Fecha de último registro</span>
          </div>
        </div>

        <div class="section-layout two-column">
          <!-- Tarjeta nuevo ingreso -->
          <div class="card primary-card">
            <div class="card-header">
              <h2>Nuevo ingreso</h2>
              <p>Captura todos los datos del cliente y del vehículo en un solo paso.</p>
            </div>
            <div class="card-body">
              <form id="ingresoForm" class="grid-form">
                <div class="field">
                  <label>Nombre del cliente</label>
                  <input name="clienteNombre" required />
                </div>
                <div class="field">
                  <label>Teléfono</label>
                  <input name="clienteTelefono" type="tel" required />
                </div>
                <div class="field">
                  <label>Dirección</label>
                  <input name="clienteDireccion" />
                </div>
                <div class="field">
                  <label>Tablilla</label>
                  <input name="vehiculoTablilla" required />
                </div>
                <div class="field">
                  <label>Marca</label>
                  <input name="vehiculoMarca" required />
                </div>
                <div class="field">
                  <label>Modelo</label>
                  <input name="vehiculoModelo" required />
                </div>
                <div class="field">
                  <label>Año</label>
                  <input name="vehiculoAno" type="number" min="1900" max="2100" />
                </div>
                <div class="field">
                  <label>Color</label>
                  <input name="vehiculoColor" />
                </div>
                <div class="field full">
                  <label>VIN Number</label>
                  <input name="vehiculoVin" />
                </div>
                <div class="field">
                  <label>Tipo de trabajo</label>
                  <select name="tipoTrabajo" required>
                    <option value="mecanica">Mecánica</option>
                    <option value="hojalateria">Hojalatería y carrocería</option>
                    <option value="pintura">Pintura</option>
                    <option value="detailing">Detailing</option>
                    <option value="otro">Otro</option>
                  </select>
                </div>
                <div class="field full">
                  <label>Trabajo sugerido / diagnóstico</label>
                  <textarea name="descripcionTrabajo" rows="3"
                    placeholder="Ej. Ruido en tren delantero, verificar frenos, golpe en guardalodo derecho, etc."></textarea>
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn primary">Guardar ingreso</button>
                  <span id="ingresoStatus" class="status-msg"></span>
                </div>
              </form>
            </div>
          </div>

          <!-- Tarjeta lista ingresos abiertos -->
          <div class="card">
            <div class="card-header compact">
              <h2>Ingresos abiertos</h2>
              <p>Vehículos actualmente en proceso dentro del taller.</p>
            </div>
            <div class="card-body">
              <div id="ingresosLista" class="table-wrap small">
                <!-- JS llenará esta tabla -->
              </div>
              <p class="card-footnote">
                Para cerrar un trabajo, usa el botón <strong>“Registrar entrega”</strong> en la fila correspondiente.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- ========== ENTREGAS (explicativa) ========== -->
      <section id="entregasView" class="screen">
        <div class="screen-header">
          <div>
            <h1>Entregas de vehículos</h1>
            <p class="section-subtitle">
              Cierre de trabajos, registro de observaciones de entrega y creación automática de facturas.
            </p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Flujo de entregas</h2>
          </div>
          <div class="card-body">
            <ol class="steps">
              <li>Ve a la pestaña <strong>Ingresos</strong> y localiza el vehículo en “Ingresos abiertos”.</li>
              <li>Presiona <strong>“Registrar entrega”</strong> en la fila del vehículo.</li>
              <li>En la tarjeta de entrega, escribe las notas y el monto facturado.</li>
              <li>El sistema marca el ingreso como <strong>entregado</strong> y crea una <strong>factura</strong>
                  pagada o pendiente.</li>
            </ol>
            <p class="placeholder">
              Toda la parte financiera se ve en la pestaña <strong>Facturas</strong>.
            </p>
          </div>
        </div>
      </section>

      <!-- ========== HISTORIAL POR CLIENTE ========== -->
      <section id="historialView" class="screen">
        <div class="screen-header">
          <div>
            <h1>Historial por cliente</h1>
            <p class="section-subtitle">
              Consulta integrada de ingresos, reparaciones y facturas por nombre, tablilla o VIN.
            </p>
          </div>
        </div>

        <div class="card">
          <div class="card-header compact">
            <h2>Buscar historial</h2>
          </div>
          <div class="card-body">
            <div class="toolbar">
              <input id="historialBuscarInput" placeholder="Nombre, tablilla o VIN..." />
              <button id="historialBuscarBtn" class="btn small primary">Buscar</button>
            </div>
            <div id="historialResultados" class="table-wrap">
              <!-- JS: resultados de historial -->
            </div>
          </div>
        </div>
      </section>

      <!-- ========== COTIZACIONES ========== -->
      <section id="cotizacionesView" class="screen">
        <div class="screen-header">
          <div>
            <h1>Cotizaciones</h1>
            <p class="section-subtitle">
              Cotizaciones dedicadas a seguros de autos y trabajos automotrices en Puerto Rico.
            </p>
          </div>
          <button id="nuevaCotizacionBtn" class="btn primary">Nueva cotización</button>
        </div>

        <div class="card">
          <div class="card-header compact">
            <h2>Historial de cotizaciones</h2>
            <p>Imprime reportes y consulta montos estimados.</p>
          </div>
          <div class="card-body">
            <div class="toolbar">
              <button id="exportCotizacionesBtn" class="btn small outline">
                Imprimir listado (PDF)
              </button>
            </div>
            <div id="cotizacionesTabla" class="table-wrap">
              <!-- JS: tabla de cotizaciones -->
            </div>
          </div>
        </div>
      </section>

      <!-- ========== FACTURAS ========== -->
      <section id="facturasView" class="screen">
        <div class="screen-header">
          <div>
            <h1>Facturas</h1>
            <p class="section-subtitle">
              Control de facturación: facturas pagadas, pendientes y pagos recibidos.
            </p>
          </div>
          <button id="nuevaFacturaBtn" class="btn primary" disabled
                  title="Las facturas se generan desde Entregas">
            Factura desde entrega
          </button>
        </div>

        <div class="section-layout">
          <!-- Resumen financiero -->
          <div class="card">
            <div class="card-header compact">
              <h2>Resumen de facturación</h2>
            </div>
            <div class="card-body">
              <div id="resumenFacturas" class="toolbar toolbar-resumen">
                <!-- JS: resumen Pagadas / Pendientes / Total cobrado -->
              </div>
            </div>
          </div>

          <!-- Tabla facturas -->
          <div class="card">
            <div class="card-header compact">
              <h2>Listado de facturas</h2>
              <p>Filtra por estado y genera listados en PDF.</p>
            </div>
            <div class="card-body">
              <div class="toolbar">
                <select id="filtroEstadoFactura" class="small-select">
                  <option value="todas">Todas</option>
                  <option value="pendiente">Pendientes de pago</option>
                  <option value="pagada">Pagadas</option>
                </select>
                <button id="exportFacturasBtn" class="btn small outline">
                  Imprimir listado (PDF)
                </button>
              </div>
              <div id="facturasTabla" class="table-wrap">
                <!-- JS: tabla de facturas -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ========== CLIENTES ========== -->
      <section id="clientesView" class="screen">
        <div class="screen-header">
          <div>
            <h1>Clientes</h1>
            <p class="section-subtitle">Directorio centralizado de clientes del taller.</p>
          </div>
          <button id="nuevoClienteBtn" class="btn primary">Nuevo cliente</button>
        </div>

        <div class="card">
          <div class="card-header compact">
            <h2>Listado de clientes</h2>
          </div>
          <div class="card-body">
            <div class="toolbar">
              <input id="buscarClienteInput" placeholder="Buscar por nombre, teléfono o dirección..." />
              <button id="buscarClienteBtn" class="btn small outline">Buscar</button>
            </div>
            <div id="clientesTabla" class="table-wrap">
              <!-- JS: tabla de clientes -->
            </div>
          </div>
        </div>
      </section>

      <!-- ========== SUPLIDORES ========== -->
      <section id="suplidoresView" class="screen">
        <div class="screen-header">
          <div>
            <h1>Suplidores</h1>
            <p class="section-subtitle">
              Control de suplidores de piezas, pintura, detailing y servicios externos.
            </p>
          </div>
          <button id="nuevoSuplidorBtn" class="btn primary">Nuevo suplidor</button>
        </div>

        <div class="card">
          <div class="card-header compact">
            <h2>Listado de suplidores</h2>
          </div>
          <div class="card-body">
            <div class="toolbar">
              <input id="buscarSuplidorInput" placeholder="Buscar por nombre, tipo o teléfono..." />
              <button id="buscarSuplidorBtn" class="btn small outline">Buscar</button>
            </div>
            <div id="suplidoresTabla" class="table-wrap">
              <!-- JS: tabla de suplidores -->
            </div>
          </div>
        </div>
      </section>

      <!-- ========== CONFIGURACIÓN ========== -->
      <section id="configView" class="screen">
        <div class="screen-header">
          <div>
            <h1>Configuración del taller</h1>
            <p class="section-subtitle">
              Identidad del taller, PIN de acceso, logo, datos de contacto y listas de precios.
            </p>
          </div>
        </div>

        <div class="section-layout two-column">
          <!-- Datos del taller -->
          <div class="card primary-card">
            <div class="card-header">
              <h2>Datos del taller</h2>
              <p>Personaliza la identidad visual y la información básica.</p>
            </div>
            <div class="card-body">
              <form id="configForm" class="grid-form">
                <div class="field full">
                  <label>Nombre del taller</label>
                  <input name="tallerNombre" placeholder="Ej. Auto Clinic PR, Taller XYZ" />
                </div>
                <div class="field">
                  <label>Teléfono principal</label>
                  <input name="tallerTelefono" />
                </div>
                <div class="field">
                  <label>Correo electrónico</label>
                  <input name="tallerEmail" type="email" />
                </div>
                <div class="field full">
                  <label>Dirección física</label>
                  <input name="tallerDireccion" />
                </div>
                <div class="field">
                  <label>Logo del taller (URL)</label>
                  <input name="logoUrl" placeholder="https://..." />
                </div>
                <div class="field">
                  <label>PIN de acceso nuevo</label>
                  <input name="pinNuevo" type="password" maxlength="6" placeholder="••••" />
                </div>
                <div class="field full">
                  <label>Enlace carpeta de fotos en Google Drive (antes/después)</label>
                  <input name="driveUrl" placeholder="https://drive.google.com/..." />
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn primary">Guardar configuración</button>
                  <span id="configStatus" class="status-msg"></span>
                </div>
              </form>
            </div>
          </div>

          <!-- Lista de precios -->
          <div class="card">
            <div class="card-header">
              <h2>Listas de precios</h2>
              <p>Plantilla de servicios para mecánica, hojalatería, pintura y detailing.</p>
            </div>
            <div class="card-body">
              <div class="toolbar">
                <button id="nuevoPrecioBtn" class="btn small primary">Añadir servicio</button>
              </div>
              <div id="preciosTabla" class="table-wrap">
                <!-- JS: lista de precios -->
              </div>
              <p class="card-footnote">
                Estos precios pueden utilizarse como referencia al crear cotizaciones y facturas.
              </p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- ========== MODAL GLOBAL (SIN PROMPTS AZULES) ========== -->
    <div id="dialogBackdrop" class="dialog-backdrop hidden">
      <div class="dialog-card">
        <div class="dialog-header">
          <h2 id="dialogTitle">Título</h2>
        </div>
        <form id="dialogForm" class="dialog-body">
          <div id="dialogFields" class="dialog-fields">
            <!-- JS inyecta los campos -->
          </div>
          <div class="dialog-actions">
            <button type="button" id="dialogCancelBtn" class="btn outline">Cancelar</button>
            <button type="submit" id="dialogSubmitBtn" class="btn primary">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="app.js?v=10"></script>
</body>
</html>
